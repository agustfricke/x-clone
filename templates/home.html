<div class="mr-[50px]">
  <div class="border-x border-zinc-600">
    <div class="border-b border-zinc-600">
      <div class="grid grid-cols-11">
        <div class="col-span-5">
          <a
            href="/home"
            class="flex justify-center py-4 hover:bg-zinc-600 transition duration-300 ease-in-out hover:bg-opacity-30"
          >
            For you
          </a>
        </div>
        <div class="col-span-5">
          <a
            href="/home"
            class="flex justify-center py-4 hover:bg-zinc-600 transition duration-300 ease-in-out hover:bg-opacity-30"
          >
            Following
          </a>
        </div>
        <a
          href="settings"
          class="flex justify-center p-2 m-2 col-span-1 hover:bg-zinc-600 rounded-full hover:rounded-full transition duration-300 ease-in-out hover:bg-opacity-30"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            fill="currentColor"
            class="bi bi-gear mt-[2px]"
            viewBox="0 0 16 16"
          >
            <path
              d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z"
            />
            <path
              d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115l.094-.319z"
            />
          </svg>
        </a>
      </div>
    </div>

    <form id="form">
      <div class="flex">
        <img
          class="rounded-full w-16 h-16 m-3"
          src="https://avatars.githubusercontent.com/u/110266171?s=400&u=4ff22a88a26e74d36f4cdd652dc566d836e98e5e&v=4"
        />

        <textarea
          type="text"
          id="msg"
          size="64"
          autofocus
          autocomplete="off"
          rows="3"
          class="w-full mb-3 mt-7 bg-transparent outline-none border-b border-zinc-600"
          placeholder="Whatâ€™s happening?!"
        >
        </textarea>
      </div>

      <div class="grid grid-cols-11">
        <div class="col-span-5">
          <div class="flex justify-center">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="22"
              height="22"
              fill="currentColor"
              class="bi bi-card-image text-indigo-300 hover:text-indigo-400"
              viewBox="0 0 16 16"
            >
              <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z" />
              <path
                d="M1.5 2A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13zm13 1a.5.5 0 0 1 .5.5v6l-3.775-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12v.54A.505.505 0 0 1 1 12.5v-9a.5.5 0 0 1 .5-.5h13z"
              />
            </svg>
          </div>
        </div>

        <div class="col-span-5">
          <div class="flex justify-end">
            <button
              type="submit"
              class="bg-indigo-500 mb-3 w-[120px] mr-2 hover:bg-indigo-500 transition duration-300 ease-in-out hover:bg-opacity-50 p-2 px-5 rounded-full text-white font-bold"
            >
              Post
            </button>
          </div>
        </div>
      </div>
    </form>

    <div id="log" class="border-b border-zinc-600"></div>
  </div>
</div>

<script type="text/javascript">
  window.onload = function () {
    var conn;
    var msg = document.getElementById("msg");

    function appendLog(data) {
      const card = document.createElement("div");

      card.innerHTML = `
        <div id="innerHTML_${data.id}">
          <h5 class="text-red-200">${data.title}</h5>
          <button id="delete_${data.id}">Delete</button>
          <button id="edit_${data.id}">Edit</button>
        </div>
      `;

      const container = document.getElementById("log");
      container.appendChild(card);

      const editButton = document.getElementById(`edit_${data.id}`);
      editButton.addEventListener("click", function () {
        const me = document.getElementById(`innerHTML_${data.id}`);

        const currentTitle = data.title;

        const inputField = document.createElement("input");
        const classesToAdd = [
          "w-full",
          "mb-3",
          "mt-7",
          "bg-transparent",
          "outline-none",
          "border-b",
          "border-zinc-600",
        ];

        // Agregar cada clase individualmente
        classesToAdd.forEach((className) => {
          inputField.classList.add(className);
        });
        inputField.value = currentTitle;

        const saveButton = document.createElement("button");
        saveButton.innerText = "Guardar";

        saveButton.addEventListener("click", () => {
          const updatedMessage = {
            id: data.id,
            title: inputField.value,
            action: "normal",
          };

          var oldMessage = {
            id: data.id,
            title: data.title,
            action: "delete",
          };

          conn.send(JSON.stringify(updatedMessage));
          conn.send(JSON.stringify(oldMessage));

          me.removeChild(inputField);
          me.removeChild(saveButton);
        });

        me.innerHTML = "";
        me.appendChild(inputField);
        me.appendChild(saveButton);
      });

      const deleteButton = document.getElementById(`delete_${data.id}`);
      deleteButton.addEventListener("click", function () {
        const deleteMessage = {
          id: data.id,
          title: data.title,
          action: "delete",
        };

        conn.send(JSON.stringify(deleteMessage));
      });
    }

    document.getElementById("form").onsubmit = function () {
      if (!conn) {
        return false;
      }
      if (!msg.value) {
        return false;
      }

      function generateRandomId() {
        const timestamp = new Date().getTime();
        const randomNum = Math.floor(Math.random() * 10000);
        return `${timestamp}${randomNum}`;
      }

      const randomId = generateRandomId();
      const newMessage = {
        id: randomId,
        title: msg.value,
        action: "normal",
      };

      conn.send(JSON.stringify(newMessage));
      msg.value = "";
      return false;
    };

    if (window["WebSocket"]) {
      conn = new WebSocket("ws://" + document.location.host + "/ws/feed");
      conn.onclose = function (evt) {
        var item = document.createElement("div");
        item.innerHTML = "<b>Connection closed.</b>";
        appendLog(item);
      };
      conn.onmessage = function (evt) {
        var message = evt.data;

        if (message.startsWith("Deleted message: ")) {
          var startIndex = message.indexOf("{");
          var jsonPart = message.slice(startIndex);
          var jsonObject = JSON.parse(jsonPart);

          var id = jsonObject.id;
          messageToDel = `innerHTML_${id}`;
          messageToDelInTheDom = document.getElementById(`innerHTML_${id}`);
          let otherId = messageToDelInTheDom.id;
          if (messageToDel == otherId) {
            messageToDelInTheDom.remove();
          }
        } else {
          var jsonMessage = JSON.parse(evt.data);
          appendLog(jsonMessage);
        }
      };
    } else {
      var item = document.createElement("div");
      item.innerHTML = "<b>Your browser does not support WebSockets.</b>";
      appendLog(item);
    }
  };
</script>
